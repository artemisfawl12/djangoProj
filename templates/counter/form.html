<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BACKTOCKS.NET</title>
    <style>
        .hidden-text {
                display: none; /* 기본적으로 숨김 */
            }

        .visible {
            display: block; /* 보이게 변경 */
        }
        /*loader style*/
        .loader {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 3em;
            position: relative;
            vertical-align: middle;
        }
        .loader,
    .loader:before,
    .loader:after {
        animation: 1s infinite ease-in-out;
    }
    .loader:before,
    .loader:after {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        position: absolute;
        top: 0;
        left: 0;
    }
        .loader-3:before {
        content: '';
        border: 10px solid white;
        top: -10px;
        left: -10px;
        animation-name: loader3;
        }
        .loader-black{
            background-color: #333;
        }
        .loader.visible{
            display: inline-block;
        }

        @keyframes loader3 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }


        /* 기본 스타일 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 10px 0;
        }
        h1 {
            margin: 10px 0;
        }
        form {
            margin: 20px auto;
            max-width: 500px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        label {
            display: block;
            margin-bottom: 8px;
        }
        input {
            width: 90%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .input_large {
            width: 90%;
            height: 50px;
            padding: 8px;
            margin-top: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            width: 100%;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        a {
            display: inline-block;
            margin-top: 20px;
            margin-bottom: 20px;
            height: 30px;
            text-decoration: none;
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s;
            text-align: center;
            font-size: 16px;
        }
        a:hover {
            background-color: #45a049;
        }

        /* 반응형 처리 */
        @media (max-width: 600px) {
            form {
                width: 90%;
            }
        }

    </style>
</head>
<body>
    <header>
        <h1>작가 수익 계산기</h1>
    </header>
    <main>
        <form id="wholeform" method="POST">
            {% csrf_token %}
            <label for="name">INPUT</label>

            <label for="mg">정산 방식 선택:</label>
            <select id="mg" name="mg" required>
                <option value="0">월 MG</option>
                <option value="1">누적MG</option>
                <option value="2">통합MG</option>
            </select>
            <label for="subtract">차감 방식 선택:</label>
            <select id="subtract" name="subtract" required>
                <option value="0">선차감</option>
                <option value="1">후차감</option>
            </select>
            <input type="text" id="period" name="period" placeholder="연재기간" required>
            <input type="text" id="mg_money" name="mg_money" placeholder="1화당 mg금액" required>
            <input type="text" id="publish_count" name="publish_count" placeholder="1달기준 연재횟수" required>
            <p><strong> 아래 3개의 수치는 월 MG면 월별로 적어주시고, 누적/통합MG이면 연 수익 기준으로 적어주세요. </strong> </p>

            <input type="text" id="revenue_1" name="revenue_1" placeholder="월 예상 수익" required>

            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" id="rs_author" name="rs_author" placeholder="작가 수익비율 입력:" required style="padding: 8px; font-size: 14px; flex: 1;">
                <input type="text" id="rs_company" name="rs_company" placeholder="에이전시 수익비율:" required style="padding: 8px; font-size: 14px; flex: 1;">
                <input type="text" id="rs_portal" name="rs_portal" placeholder="포털사이트 수익비율:" required style="padding: 8px; font-size: 14px; flex: 1;">
            </div>

            <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
            <button id="submitbtn" type="submit" onclick="showLoading()">확인</button>
            <p id="loadtxt" class="hidden-text"><strong>mg만 가지고 받을 수 있는 돈은 딱히 제시하지 않겠습니다.</strong></p>
            <p id="loadtxt" class="hidden-text"><strong>예상 총수익은:</strong></p>
            <div id="loss_total"></div>
            <div id="surplus_month"></div>
            <div id="income_total"></div>
            <div id="income_month"></div>
            <p id="loadtxt" class="hidden-text">위는 mg 달성 못했을때 빠지는 돈까지 뺀겁니다.</p>
            <p id="loadtxt" class="hidden-text"><strong>mg와 비교했을때 월별 흑자/적자는 아래와 같습니다.</strong></p>

        </form>


    </main>
    <script>
        const btn1 = document.getElementById("submitbtn");
        const loadtxt = document.getElementById("loadtxt");
        const form=document.getElementById("wholeform");
        function showLoading(){
            loadtxt.classList.add("visible");

        };
        function getCookie(name){
            const cookies=document.cookie.split(';');
            for (let cookie of cookies){
                if (cookie.trim().startsWith(name + '=')){
                    return cookie.trim().split('=')[1];
                }
            }
            return null;
        }
        window.addEventListener('unload', () => {
            const url = '/delete-file/';
            const data = JSON.stringify({});

            navigator.sendBeacon(url, data);
        });
        $(document).ready(function() {
            $('#submitbtn').click(function() {

                event.preventDefault();

                const rs_author = $('#rs_author').val();
                const rs_company = $('#rs_company').val();
                const rs_portal=$('#rs_portal').val();
                const mg = $('#mg').val();
                const period=$('#period').val();
                const subtract = $('#subtract').val();
                const mg_money=$('#mg_money').val();
                const revenue_1 = $('#revenue_1').val();
                const publish_count=$('#publish_count').val();

                $.ajax({
                    url: '/process/',  // Django URL (views.py에 연결된 경로)
                    type: 'POST',
                    data: {
                        rs_author: rs_author,
                        rs_company: rs_company,
                        mg:mg,
                        subtract:subtract,
                        mg_money:mg_money,
                        revenue_1:revenue_1,
                        period:period,
                        rs_portal:rs_portal,
                        publish_count:publish_count,
                        csrfmiddlewaretoken: '{{ csrf_token }}'  // CSRF 토큰 포함
                    },
                    success: function(response) {
                        // 결과 출력
                        $('#income_total').text(response.income_total);
                        $('#surplus_month').text(response.surplus_month);
                        $('#income_month').text(response.income_month);
                        $('#loss_total').text(response.loss_total);
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                    }
                });
            });
        });




    </script>
</body>
</html>


